{% extends "base.html" %}

{% block title %}è©³ç´°åˆ†æ - å®¶æ—å¥åº·ç®¡ç†{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="ja" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è©³ç´°åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 min-h-screen text-white">
    <div id="analytics-root" class="p-6"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        // SVGã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        const TrendingUp = ({ className = "w-6 h-6" }) => React.createElement('svg', { 
            className, fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" 
        }, React.createElement('polyline', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            points: "23 6 13.5 15.5 8.5 10.5 1 18" 
        }), React.createElement('polyline', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            points: "17 6 23 6 23 12" 
        }));

        const BarChart = ({ className = "w-6 h-6" }) => React.createElement('svg', { 
            className, fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" 
        }, React.createElement('line', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            x1: "18", y1: "20", x2: "18", y2: "10"
        }), React.createElement('line', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            x1: "12", y1: "20", x2: "12", y2: "4"
        }), React.createElement('line', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            x1: "6", y1: "20", x2: "6", y2: "14"
        }));

        const Calendar = ({ className = "w-6 h-6" }) => React.createElement('svg', { 
            className, fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" 
        }, React.createElement('rect', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            x: "3", y: "4", width: "18", height: "18", rx: "2", ry: "2"
        }), React.createElement('line', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            x1: "16", y1: "2", x2: "16", y2: "6"
        }), React.createElement('line', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            x1: "8", y1: "2", x2: "8", y2: "6"
        }), React.createElement('line', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            x1: "3", y1: "10", x2: "21", y2: "10"
        }));

        const AnalyticsDashboard = () => {
            const [selectedPeriod, setSelectedPeriod] = useState('month');
            const [selectedMetric, setSelectedMetric] = useState('steps');
            const [selectedMember, setSelectedMember] = useState('all');
            const [chartData, setChartData] = useState(null);

            // ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
            useEffect(() => {
                generateChartData();
            }, [selectedPeriod, selectedMetric, selectedMember]);

            const generateChartData = () => {
                const periods = {
                    week: 7,
                    month: 30,
                    quarter: 90,
                    year: 365
                };

                const labels = [];
                const data = [];
                const days = periods[selectedPeriod];

                for (let i = days - 1; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    
                    if (selectedPeriod === 'week') {
                        labels.push(date.toLocaleDateString('ja-JP', { weekday: 'short' }));
                    } else if (selectedPeriod === 'month') {
                        labels.push(date.getDate());
                    } else if (selectedPeriod === 'quarter') {
                        labels.push(date.toLocaleDateString('ja-JP', { month: 'short', day: 'numeric' }));
                    } else {
                        labels.push(date.toLocaleDateString('ja-JP', { month: 'short' }));
                    }

                    // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
                    let value;
                    switch (selectedMetric) {
                        case 'steps':
                            value = Math.floor(Math.random() * 5000) + 7000;
                            break;
                        case 'calories':
                            value = Math.floor(Math.random() * 800) + 1600;
                            break;
                        case 'heartRate':
                            value = Math.floor(Math.random() * 20) + 65;
                            break;
                        case 'hrv':
                            value = Math.floor(Math.random() * 20) + 40;
                            break;
                        default:
                            value = Math.floor(Math.random() * 100);
                    }
                    data.push(value);
                }

                setChartData({ labels, data });
            };

            const renderChart = () => {
                if (!chartData) return null;

                const canvasId = `chart-${selectedMetric}-${selectedPeriod}`;
                
                useEffect(() => {
                    const canvas = document.getElementById(canvasId);
                    if (!canvas) return;

                    const ctx = canvas.getContext('2d');
                    
                    // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆã‚’ç ´æ£„
                    if (canvas.chart) {
                        canvas.chart.destroy();
                    }

                    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                    gradient.addColorStop(0, 'rgba(59, 130, 246, 0.5)');
                    gradient.addColorStop(1, 'rgba(59, 130, 246, 0.1)');

                    const chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: chartData.labels,
                            datasets: [{
                                label: getMetricLabel(selectedMetric),
                                data: chartData.data,
                                borderColor: 'rgb(59, 130, 246)',
                                backgroundColor: gradient,
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: 'rgb(59, 130, 246)',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2,
                                pointRadius: 5,
                                pointHoverRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#fff'
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#fff'
                                    }
                                }
                            }
                        }
                    });

                    canvas.chart = chart;
                }, [chartData]);

                return React.createElement('canvas', { 
                    id: canvasId, 
                    width: "400", 
                    height: "200" 
                });
            };

            const getMetricLabel = (metric) => {
                switch (metric) {
                    case 'steps': return 'æ­©æ•°';
                    case 'calories': return 'ã‚«ãƒ­ãƒªãƒ¼ (kcal)';
                    case 'heartRate': return 'å¿ƒæ‹æ•° (BPM)';
                    case 'hrv': return 'HRV';
                    default: return metric;
                }
            };

            const getMetricColor = (metric) => {
                switch (metric) {
                    case 'steps': return 'text-blue-400';
                    case 'calories': return 'text-red-400';
                    case 'heartRate': return 'text-pink-400';
                    case 'hrv': return 'text-green-400';
                    default: return 'text-blue-400';
                }
            };

            const calculateStats = () => {
                if (!chartData) return { avg: 0, max: 0, min: 0, trend: 0 };
                
                const data = chartData.data;
                const avg = Math.round(data.reduce((a, b) => a + b, 0) / data.length);
                const max = Math.max(...data);
                const min = Math.min(...data);
                
                // ç°¡å˜ãªãƒˆãƒ¬ãƒ³ãƒ‰è¨ˆç®—ï¼ˆæœ€åˆã®åŠåˆ†ã¨å¾ŒåŠã®å¹³å‡ã‚’æ¯”è¼ƒï¼‰
                const firstHalf = data.slice(0, Math.floor(data.length / 2));
                const secondHalf = data.slice(Math.floor(data.length / 2));
                const firstAvg = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;
                const secondAvg = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;
                const trend = Math.round(((secondAvg - firstAvg) / firstAvg) * 100);

                return { avg, max, min, trend };
            };

            const stats = calculateStats();

            return React.createElement('div', { className: 'max-w-7xl mx-auto' },
                // ãƒ˜ãƒƒãƒ€ãƒ¼
                React.createElement('div', { className: 'flex justify-between items-center mb-8' },
                    React.createElement('div', null,
                        React.createElement('h1', { className: 'text-3xl font-bold text-white mb-2' }, 'ğŸ“Š è©³ç´°åˆ†æ'),
                        React.createElement('p', { className: 'text-slate-300' }, 'é•·æœŸé–“ã®å¥åº·ãƒ‡ãƒ¼ã‚¿ãƒˆãƒ¬ãƒ³ãƒ‰ã¨è©³ç´°ãªåˆ†æ')
                    ),
                    React.createElement('a', {
                        href: '/',
                        className: 'bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded-lg transition-colors'
                    }, 'â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹')
                ),

                // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
                React.createElement('div', { className: 'bg-slate-800 rounded-2xl p-6 mb-8 shadow-lg' },
                    React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-6' },
                        // æœŸé–“é¸æŠ
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'æœŸé–“'),
                            React.createElement('select', {
                                value: selectedPeriod,
                                onChange: (e) => setSelectedPeriod(e.target.value),
                                className: 'w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500'
                            },
                                React.createElement('option', { value: 'week' }, 'éå»7æ—¥é–“'),
                                React.createElement('option', { value: 'month' }, 'éå»30æ—¥é–“'),
                                React.createElement('option', { value: 'quarter' }, 'éå»3ãƒ¶æœˆ'),
                                React.createElement('option', { value: 'year' }, 'éå»1å¹´')
                            )
                        ),

                        // æŒ‡æ¨™é¸æŠ
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'æŒ‡æ¨™'),
                            React.createElement('select', {
                                value: selectedMetric,
                                onChange: (e) => setSelectedMetric(e.target.value),
                                className: 'w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500'
                            },
                                React.createElement('option', { value: 'steps' }, 'æ­©æ•°'),
                                React.createElement('option', { value: 'calories' }, 'æ¶ˆè²»ã‚«ãƒ­ãƒªãƒ¼'),
                                React.createElement('option', { value: 'heartRate' }, 'å®‰é™æ™‚å¿ƒæ‹æ•°'),
                                React.createElement('option', { value: 'hrv' }, 'å¿ƒæ‹å¤‰å‹•(HRV)')
                            )
                        ),

                        // ãƒ¡ãƒ³ãƒãƒ¼é¸æŠ
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'ãƒ¡ãƒ³ãƒãƒ¼'),
                            React.createElement('select', {
                                value: selectedMember,
                                onChange: (e) => setSelectedMember(e.target.value),
                                className: 'w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:border-blue-500'
                            },
                                React.createElement('option', { value: 'all' }, 'å…¨ä½“å¹³å‡'),
                                React.createElement('option', { value: '1' }, 'ã‚‚ãˆ'),
                                React.createElement('option', { value: '2' }, 'ã™ãšã“'),
                                React.createElement('option', { value: '3' }, 'ãªãŠã²ã•')
                            )
                        )
                    )
                ),

                // çµ±è¨ˆã‚µãƒãƒªãƒ¼
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-4 gap-6 mb-8' },
                    [
                        { label: 'å¹³å‡å€¤', value: stats.avg, icon: 'ğŸ“Š' },
                        { label: 'æœ€å¤§å€¤', value: stats.max, icon: 'ğŸ“ˆ' },
                        { label: 'æœ€å°å€¤', value: stats.min, icon: 'ğŸ“‰' },
                        { label: 'ãƒˆãƒ¬ãƒ³ãƒ‰', value: `${stats.trend > 0 ? '+' : ''}${stats.trend}%`, icon: stats.trend >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰' }
                    ].map((stat, index) =>
                        React.createElement('div', {
                            key: index,
                            className: 'bg-slate-800 rounded-2xl p-6 shadow-lg'
                        },
                            React.createElement('div', { className: 'flex items-center justify-between mb-2' },
                                React.createElement('span', { className: 'text-slate-400 text-sm' }, stat.label),
                                React.createElement('span', { className: 'text-2xl' }, stat.icon)
                            ),
                            React.createElement('div', { className: `text-2xl font-bold ${getMetricColor(selectedMetric)}` }, stat.value)
                        )
                    )
                ),

                // ãƒ¡ã‚¤ãƒ³ãƒãƒ£ãƒ¼ãƒˆ
                React.createElement('div', { className: 'bg-slate-800 rounded-2xl p-6 mb-8 shadow-lg' },
                    React.createElement('div', { className: 'flex items-center justify-between mb-6' },
                        React.createElement('h2', { className: 'text-xl font-bold flex items-center' },
                            React.createElement(TrendingUp, { className: 'w-6 h-6 mr-2' }),
                            `${getMetricLabel(selectedMetric)}ã®æ¨ç§»`
                        ),
                        React.createElement('div', { className: 'flex space-x-2' },
                            ['line', 'bar'].map(type =>
                                React.createElement('button', {
                                    key: type,
                                    className: `px-3 py-1 rounded-lg text-sm transition-colors ${
                                        type === 'line' 
                                            ? 'bg-blue-600 text-white' 
                                            : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                    }`
                                }, type === 'line' ? 'ç·šã‚°ãƒ©ãƒ•' : 'æ£’ã‚°ãƒ©ãƒ•')
                            )
                        )
                    ),
                    React.createElement('div', { className: 'h-96' }, renderChart())
                ),

                // è©³ç´°åˆ†æ
                React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-6' },
                    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
                    React.createElement('div', { className: 'bg-slate-800 rounded-2xl p-6 shadow-lg' },
                        React.createElement('h2', { className: 'text-xl font-bold mb-4 flex items-center' },
                            React.createElement(BarChart, { className: 'w-6 h-6 mr-2' }),
                            'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ'
                        ),
                        React.createElement('div', { className: 'space-y-4' },
                            [
                                { label: 'ç›®æ¨™é”æˆç‡', value: '73%', color: 'bg-green-600' },
                                { label: 'ä¸€è²«æ€§ã‚¹ã‚³ã‚¢', value: '8.2/10', color: 'bg-blue-600' },
                                { label: 'æ”¹å–„ç‡', value: '+12%', color: 'bg-purple-600' },
                                { label: 'é€±é–“ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ—¥', value: '5.2æ—¥', color: 'bg-yellow-600' }
                            ].map((metric, index) =>
                                React.createElement('div', {
                                    key: index,
                                    className: 'flex items-center justify-between p-3 bg-slate-700 rounded-lg'
                                },
                                    React.createElement('span', null, metric.label),
                                    React.createElement('span', {
                                        className: `px-3 py-1 rounded-full text-white text-sm ${metric.color}`
                                    }, metric.value)
                                )
                            )
                        )
                    ),

                    // ã‚¤ãƒ³ã‚µã‚¤ãƒˆ
                    React.createElement('div', { className: 'bg-slate-800 rounded-2xl p-6 shadow-lg' },
                        React.createElement('h2', { className: 'text-xl font-bold mb-4 flex items-center' },
                            React.createElement(Calendar, { className: 'w-6 h-6 mr-2' }),
                            'ã‚¤ãƒ³ã‚µã‚¤ãƒˆ'
                        ),
                        React.createElement('div', { className: 'space-y-4' },
                            [
                                { 
                                    title: 'æœ€ã‚‚æ´»ç™ºãªæ™‚æœŸ', 
                                    desc: 'éå»30æ—¥é–“ã§æœ€ã‚‚è‰¯ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è¨˜éŒ²ã—ãŸã®ã¯å…ˆé€±ã§ã—ãŸã€‚',
                                    type: 'success'
                                },
                                { 
                                    title: 'æ”¹å–„ã®ãƒãƒ£ãƒ³ã‚¹', 
                                    desc: 'é€±æœ«ã®æ´»å‹•é‡ãŒå¹³æ—¥ã‚ˆã‚Š20%ä½ä¸‹ã—ã¦ã„ã¾ã™ã€‚', 
                                    type: 'warning'
                                },
                                { 
                                    title: 'ç¶™ç¶šã®åŠ›', 
                                    desc: '14æ—¥é€£ç¶šã§ç›®æ¨™ã‚’é”æˆä¸­ã§ã™ã€‚ç´ æ™´ã‚‰ã—ã„ä¸€è²«æ€§ã§ã™ï¼', 
                                    type: 'info'
                                }
                            ].map((insight, index) =>
                                React.createElement('div', {
                                    key: index,
                                    className: `p-4 rounded-lg border-l-4 ${
                                        insight.type === 'success' ? 'bg-green-900 border-green-400' :
                                        insight.type === 'warning' ? 'bg-yellow-900 border-yellow-400' :
                                        'bg-blue-900 border-blue-400'
                                    }`
                                },
                                    React.createElement('h4', { className: 'font-semibold mb-1' }, insight.title),
                                    React.createElement('p', { className: 'text-sm text-slate-300' }, insight.desc)
                                )
                            )
                        )
                    )
                ),

                // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³
                React.createElement('div', { className: 'mt-8 text-center' },
                    React.createElement('button', {
                        className: 'bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors font-medium mr-4'
                    }, 'ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ'),
                    React.createElement('button', {
                        className: 'bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors font-medium'
                    }, 'ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ')
                )
            );
        };

        // React ã‚¢ãƒ—ãƒªã‚’ãƒã‚¦ãƒ³ãƒˆ
        const root = createRoot(document.getElementById('analytics-root'));
        root.render(React.createElement(AnalyticsDashboard));
    </script>
</body>
</html>
{% endblock %}