{% extends "base.html" %}

{% block title %}å®¶æ—ã®å¥åº·ãƒ‡ãƒ¼ã‚¿ - å®¶æ—å¥åº·ç®¡ç†{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="ja" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶æ—å¥åº·ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 min-h-screen text-white">
    <div id="family-dashboard-root" class="p-6"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        // SVGã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        const Users = ({ className = "w-6 h-6" }) => React.createElement('svg', { 
            className, fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" 
        }, React.createElement('path', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            d: "M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a4 4 0 11-8 0 4 4 0 018 0z" 
        }));

        const Activity = ({ className = "w-6 h-6" }) => React.createElement('svg', { 
            className, fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" 
        }, React.createElement('polyline', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            points: "22,12 18,12 15,21 9,3 6,12 2,12" 
        }));

        const Heart = ({ className = "w-6 h-6" }) => React.createElement('svg', { 
            className, fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" 
        }, React.createElement('path', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            d: "M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" 
        }));

        const Footprints = ({ className = "w-6 h-6" }) => React.createElement('svg', { 
            className, fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" 
        }, React.createElement('path', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            d: "M18 20V10M6 20V10M12 16V4M8 12l4-4 4 4" 
        }));

        const TrendingUp = ({ className = "w-6 h-6" }) => React.createElement('svg', { 
            className, fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" 
        }, React.createElement('polyline', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            points: "23 6 13.5 15.5 8.5 10.5 1 18" 
        }), React.createElement('polyline', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            points: "17 6 23 6 23 12" 
        }));

        const Trophy = ({ className = "w-6 h-6" }) => React.createElement('svg', { 
            className, fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" 
        }, React.createElement('path', { 
            strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, 
            d: "M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" 
        }));

        const FamilyDashboard = () => {
            const [familyData, setFamilyData] = useState(null);
            const [selectedPeriod, setSelectedPeriod] = useState('week');
            const [loading, setLoading] = useState(true);

            // å®¶æ—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            useEffect(() => {
                const fetchFamilyData = async () => {
                    try {
                        // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯APIã‹ã‚‰å–å¾—ï¼‰
                        const demoFamilyData = {
                            groupName: "{{ family_group.name if family_group else 'ç”°ä¸­ãƒ•ã‚¡ãƒŸãƒªãƒ¼' }}",
                            inviteCode: "{{ family_group.invite_code if family_group else 'ABC123' }}",
                            totalMembers: {{ family_members|length if family_members else 3 }},
                            members: [
                                {
                                    id: 1,
                                    name: "ã‚‚ãˆ",
                                    avatar: "ğŸ‘©",
                                    status: "excellent",
                                    todaySteps: 11250,
                                    todayCalories: 2150,
                                    heartRate: 72,
                                    weeklyGoalProgress: 92,
                                    monthlyRank: 1,
                                    achievements: ["ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¹ã‚¿ãƒ¼", "é€±é–“ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³"]
                                },
                                {
                                    id: 2,
                                    name: "ã™ãšã“",
                                    avatar: "ğŸ‘§",
                                    status: "good",
                                    todaySteps: 8750,
                                    todayCalories: 1850,
                                    heartRate: 68,
                                    weeklyGoalProgress: 78,
                                    monthlyRank: 2,
                                    achievements: ["ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚­ãƒƒãƒ‰"]
                                },
                                {
                                    id: 3,
                                    name: "ãªãŠã²ã•",
                                    avatar: "ğŸ‘¨",
                                    status: "active",
                                    todaySteps: 9500,
                                    todayCalories: 2250,
                                    heartRate: 75,
                                    weeklyGoalProgress: 85,
                                    monthlyRank: 3,
                                    achievements: ["æœæ´»ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³", "ä¸€è²«æ€§ç‹"]
                                }
                            ],
                            familyStats: {
                                totalSteps: 29500,
                                totalCalories: 6250,
                                avgHeartRate: 72,
                                activeMembers: 3,
                                weeklyGoal: 80000,
                                weeklyProgress: 85
                            }
                        };
                        
                        setFamilyData(demoFamilyData);
                        setLoading(false);
                    } catch (error) {
                        console.error('Error fetching family data:', error);
                        setLoading(false);
                    }
                };

                fetchFamilyData();
            }, []);

            const getStatusColor = (status) => {
                switch (status) {
                    case 'excellent': return 'bg-green-400';
                    case 'good': return 'bg-blue-400';
                    case 'active': return 'bg-yellow-400';
                    case 'warning': return 'bg-orange-400';
                    default: return 'bg-gray-400';
                }
            };

            const getStatusText = (status) => {
                switch (status) {
                    case 'excellent': return 'çµ¶å¥½èª¿';
                    case 'good': return 'è‰¯å¥½';
                    case 'active': return 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–';
                    case 'warning': return 'æ³¨æ„';
                    default: return 'é€šå¸¸';
                }
            };

            if (loading) {
                return React.createElement('div', { className: 'flex items-center justify-center min-h-screen' },
                    React.createElement('div', { className: 'text-center' },
                        React.createElement('div', { className: 'animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4' }),
                        React.createElement('p', { className: 'text-slate-300' }, 'å®¶æ—ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...')
                    )
                );
            }

            if (!familyData) {
                return React.createElement('div', { className: 'text-center py-12' },
                    React.createElement('p', { className: 'text-slate-300' }, 'å®¶æ—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚')
                );
            }

            return React.createElement('div', { className: 'max-w-7xl mx-auto' },
                // ãƒ˜ãƒƒãƒ€ãƒ¼
                React.createElement('div', { className: 'flex justify-between items-center mb-8' },
                    React.createElement('div', null,
                        React.createElement('h1', { className: 'text-3xl font-bold text-white mb-2' }, 
                            `ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ${familyData.groupName}`
                        ),
                        React.createElement('p', { className: 'text-slate-300' }, 
                            `${familyData.totalMembers}äººã®å®¶æ— â€¢ æ‹›å¾…ã‚³ãƒ¼ãƒ‰: ${familyData.inviteCode}`
                        )
                    ),
                    React.createElement('div', { className: 'flex space-x-3' },
                        ['week', 'month'].map(period => 
                            React.createElement('button', {
                                key: period,
                                onClick: () => setSelectedPeriod(period),
                                className: `px-4 py-2 rounded-lg transition-colors ${
                                    selectedPeriod === period 
                                        ? 'bg-blue-600 text-white' 
                                        : 'bg-slate-700 text-slate-300 hover:bg-slate-600'
                                }`
                            }, period === 'week' ? 'ä»Šé€±' : 'ä»Šæœˆ')
                        )
                    )
                ),

                // å®¶æ—çµ±è¨ˆã‚µãƒãƒªãƒ¼
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-4 gap-6 mb-8' },
                    [
                        { icon: Footprints, label: 'åˆè¨ˆæ­©æ•°', value: familyData.familyStats.totalSteps.toLocaleString(), color: 'bg-blue-600' },
                        { icon: Activity, label: 'åˆè¨ˆã‚«ãƒ­ãƒªãƒ¼', value: `${familyData.familyStats.totalCalories.toLocaleString()}kcal`, color: 'bg-red-600' },
                        { icon: Heart, label: 'å¹³å‡å¿ƒæ‹æ•°', value: `${familyData.familyStats.avgHeartRate} BPM`, color: 'bg-pink-600' },
                        { icon: Users, label: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¡ãƒ³ãƒãƒ¼', value: `${familyData.familyStats.activeMembers}/${familyData.totalMembers}äºº`, color: 'bg-green-600' }
                    ].map((stat, index) =>
                        React.createElement('div', {
                            key: index,
                            className: `${stat.color} rounded-2xl p-6 shadow-lg`
                        },
                            React.createElement('div', { className: 'flex items-center justify-between' },
                                React.createElement(stat.icon, { className: 'w-8 h-8' }),
                                React.createElement('div', { className: 'text-right' },
                                    React.createElement('div', { className: 'text-2xl font-bold' }, stat.value),
                                    React.createElement('div', { className: 'text-sm opacity-90' }, stat.label)
                                )
                            )
                        )
                    )
                ),

                // å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ‰
                React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8' },
                    familyData.members.map((member) =>
                        React.createElement('div', {
                            key: member.id,
                            className: 'bg-slate-800 rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer',
                            onClick: () => window.location.href = `/member/${member.name}/achievement`
                        },
                            // ãƒ¡ãƒ³ãƒãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼
                            React.createElement('div', { className: 'flex items-center justify-between mb-4' },
                                React.createElement('div', { className: 'flex items-center space-x-3' },
                                    React.createElement('div', { className: 'text-3xl' }, member.avatar),
                                    React.createElement('div', null,
                                        React.createElement('h3', { className: 'text-lg font-semibold' }, member.name),
                                        React.createElement('div', { className: 'flex items-center space-x-2' },
                                            React.createElement('div', { className: `w-2 h-2 rounded-full ${getStatusColor(member.status)}` }),
                                            React.createElement('span', { className: 'text-sm text-slate-300' }, getStatusText(member.status))
                                        )
                                    )
                                ),
                                React.createElement('div', { className: 'text-center' },
                                    React.createElement('div', { className: 'text-2xl font-bold text-yellow-400' }, `#${member.monthlyRank}`),
                                    React.createElement('div', { className: 'text-xs text-slate-400' }, 'æœˆé–“é †ä½')
                                )
                            ),

                            // ä»Šæ—¥ã®æ•°å€¤
                            React.createElement('div', { className: 'grid grid-cols-2 gap-4 mb-4' },
                                React.createElement('div', { className: 'text-center' },
                                    React.createElement('div', { className: 'text-xl font-bold text-blue-400' }, member.todaySteps.toLocaleString()),
                                    React.createElement('div', { className: 'text-xs text-slate-400' }, 'æ­©æ•°')
                                ),
                                React.createElement('div', { className: 'text-center' },
                                    React.createElement('div', { className: 'text-xl font-bold text-red-400' }, member.todayCalories),
                                    React.createElement('div', { className: 'text-xs text-slate-400' }, 'kcal')
                                )
                            ),

                            // é€±é–“é€²æ—
                            React.createElement('div', { className: 'mb-4' },
                                React.createElement('div', { className: 'flex justify-between mb-1' },
                                    React.createElement('span', { className: 'text-sm text-slate-300' }, 'é€±é–“ç›®æ¨™'),
                                    React.createElement('span', { className: 'text-sm font-medium' }, `${member.weeklyGoalProgress}%`)
                                ),
                                React.createElement('div', { className: 'w-full bg-slate-700 rounded-full h-2' },
                                    React.createElement('div', {
                                        className: 'bg-green-400 h-2 rounded-full transition-all duration-500',
                                        style: { width: `${member.weeklyGoalProgress}%` }
                                    })
                                )
                            ),

                            // å®Ÿç¸¾ãƒãƒƒã‚¸
                            React.createElement('div', { className: 'flex flex-wrap gap-1' },
                                member.achievements.map((achievement, index) =>
                                    React.createElement('span', {
                                        key: index,
                                        className: 'bg-yellow-600 text-yellow-100 text-xs px-2 py-1 rounded-full'
                                    }, achievement)
                                )
                            )
                        )
                    )
                ),

                // å®¶æ—ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¨æˆæœ
                React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-6' },
                    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ£ãƒ¬ãƒ³ã‚¸
                    React.createElement('div', { className: 'bg-slate-800 rounded-2xl p-6 shadow-lg' },
                        React.createElement('h2', { className: 'text-xl font-bold mb-4 flex items-center' },
                            React.createElement(Trophy, { className: 'w-6 h-6 mr-2 text-yellow-400' }),
                            'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ£ãƒ¬ãƒ³ã‚¸'
                        ),
                        React.createElement('div', { className: 'space-y-4' },
                            [
                                { name: 'é€±é–“80,000æ­©ãƒãƒ£ãƒ¬ãƒ³ã‚¸', progress: familyData.familyStats.weeklyProgress, target: '80,000æ­©' },
                                { name: 'å…¨å“¡ç›®æ¨™é”æˆ', progress: 67, target: '7æ—¥é€£ç¶š' },
                                { name: 'å®¶æ—ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°', progress: 45, target: 'é€±3å›' }
                            ].map((challenge, index) =>
                                React.createElement('div', { key: index },
                                    React.createElement('div', { className: 'flex justify-between mb-1' },
                                        React.createElement('span', { className: 'text-sm font-medium' }, challenge.name),
                                        React.createElement('span', { className: 'text-sm text-slate-400' }, `${challenge.progress}%`)
                                    ),
                                    React.createElement('div', { className: 'w-full bg-slate-700 rounded-full h-2' },
                                        React.createElement('div', {
                                            className: 'bg-purple-400 h-2 rounded-full transition-all duration-500',
                                            style: { width: `${challenge.progress}%` }
                                        })
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: 'mt-4' },
                            React.createElement('a', {
                                href: '/family/challenges',
                                className: 'bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors inline-block'
                            }, 'æ–°ã—ã„ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’ä½œæˆ')
                        )
                    ),

                    // å®¶æ—ã®æˆæœ
                    React.createElement('div', { className: 'bg-slate-800 rounded-2xl p-6 shadow-lg' },
                        React.createElement('h2', { className: 'text-xl font-bold mb-4 flex items-center' },
                            React.createElement(TrendingUp, { className: 'w-6 h-6 mr-2 text-green-400' }),
                            'å®¶æ—ã®æˆæœ'
                        ),
                        React.createElement('div', { className: 'space-y-3' },
                            [
                                { achievement: '30æ—¥é€£ç¶šå…¨å“¡æ´»å‹•', date: '2025å¹´6æœˆ', type: 'gold' },
                                { achievement: 'é€±é–“ç›®æ¨™10å›é”æˆ', date: '2025å¹´5æœˆ', type: 'silver' },
                                { achievement: 'å®¶æ—ãƒãƒ£ãƒ¬ãƒ³ã‚¸åˆå›å®Œèµ°', date: '2025å¹´4æœˆ', type: 'bronze' }
                            ].map((item, index) =>
                                React.createElement('div', {
                                    key: index,
                                    className: 'flex items-center justify-between p-3 bg-slate-700 rounded-lg'
                                },
                                    React.createElement('div', null,
                                        React.createElement('div', { className: 'font-medium' }, item.achievement),
                                        React.createElement('div', { className: 'text-sm text-slate-400' }, item.date)
                                    ),
                                    React.createElement('div', {
                                        className: `w-8 h-8 rounded-full flex items-center justify-center ${
                                            item.type === 'gold' ? 'bg-yellow-600' : 
                                            item.type === 'silver' ? 'bg-gray-400' : 'bg-orange-600'
                                        }`
                                    }, 
                                        item.type === 'gold' ? 'ğŸ¥‡' : 
                                        item.type === 'silver' ? 'ğŸ¥ˆ' : 'ğŸ¥‰'
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: 'mt-4' },
                            React.createElement('a', {
                                href: '/goals/achievements',
                                className: 'bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors inline-block'
                            }, 'ã™ã¹ã¦ã®å®Ÿç¸¾ã‚’è¦‹ã‚‹')
                        )
                    )
                )
            );
        };

        // React ã‚¢ãƒ—ãƒªã‚’ãƒã‚¦ãƒ³ãƒˆ
        const root = createRoot(document.getElementById('family-dashboard-root'));
        root.render(React.createElement(FamilyDashboard));
    </script>
</body>
</html>
{% endblock %}