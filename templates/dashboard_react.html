{% extends "base.html" %}

{% block title %}React Health Dashboard - å®¶æ—å¥åº·ç®¡ç†ã‚¢ãƒ—ãƒª{% endblock %}

{% block head %}
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js"></script>
<style>
  /* Tailwind to Bootstrap conversion */
  .min-h-screen { min-height: 100vh; }
  .bg-gradient-to-br { 
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); 
  }
  .from-slate-900 { /* handled in bg-gradient-to-br */ }
  .via-slate-800 { /* handled in bg-gradient-to-br */ }
  .to-slate-900 { /* handled in bg-gradient-to-br */ }
  .text-slate-300 { color: #cbd5e1; }
  .text-slate-400 { color: #94a3b8; }
  .text-slate-700 { color: #334155; }
  .bg-slate-800 { background-color: #1e293b; }
  .bg-slate-700 { background-color: #334155; }
  .border-slate-700 { border-color: #334155; }
  .bg-green-400 { background-color: #4ade80; }
  .bg-red-400 { background-color: #f87171; }
  .bg-blue-400 { background-color: #60a5fa; }
  .bg-yellow-400 { background-color: #facc15; }
  .bg-pink-400 { background-color: #f472b6; }
  .bg-green-500 { background-color: #22c55e; }
  .bg-blue-500 { background-color: #3b82f6; }
  .bg-blue-600 { background-color: #2563eb; }
  .bg-blue-700 { background-color: #1d4ed8; }
  .bg-purple-500 { background-color: #a855f7; }
  .bg-purple-600 { background-color: #9333ea; }
  .bg-purple-700 { background-color: #7c3aed; }
  .bg-yellow-500 { background-color: #eab308; }
  .bg-gray-500 { background-color: #6b7280; }
  .text-green-400 { color: #4ade80; }
  .text-red-400 { color: #f87171; }
  .text-blue-400 { color: #60a5fa; }
  .text-yellow-400 { color: #facc15; }
  .text-pink-400 { color: #f472b6; }
  .text-yellow-300 { color: #fde047; }
  .text-green-100 { color: #dcfce7; }
  .text-blue-100 { color: #dbeafe; }
  .text-gray-700 { color: #374151; }
  .space-x-3 > * + * { margin-left: 0.75rem; }
  .space-y-3 > * + * { margin-top: 0.75rem; }
  .overflow-x-auto { overflow-x: auto; }
  .flex-shrink-0 { flex-shrink: 0; }
  .rounded-xl { border-radius: 0.75rem; }
  .rounded-2xl { border-radius: 1rem; }
  .rounded-full { border-radius: 9999px; }
  .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); }
  .shadow-blue-600\/30 { box-shadow: 0 10px 15px -3px rgba(37,99,235,0.3); }
  .cursor-pointer { cursor: pointer; }
  .transition-all { transition: all 0.15s ease-in-out; }
  .duration-300 { transition-duration: 300ms; }
  .duration-500 { transition-duration: 500ms; }
  .hover\:bg-slate-700:hover { background-color: #334155; }
  .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
  .hover\:bg-purple-700:hover { background-color: #7c3aed; }
  .transform { transform: translate(0); }
  .-rotate-90 { transform: rotate(-90deg); }
  .absolute { position: absolute; }
  .relative { position: relative; }
  .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
  .grid { display: grid; }
  .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
  .gap-4 { gap: 1rem; }
  .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
  .-top-1 { top: -0.25rem; }
  .-right-1 { right: -0.25rem; }
  .w-2 { width: 0.5rem; }
  .h-2 { width: 0.5rem; }
  .w-3 { width: 0.75rem; }
  .h-3 { height: 0.75rem; }
  .w-5 { width: 1.25rem; }
  .h-5 { height: 1.25rem; }
  .w-6 { width: 1.5rem; }
  .h-6 { height: 1.5rem; }
  .w-32 { width: 8rem; }
  .mx-auto { margin-left: auto; margin-right: auto; }
  .mt-1 { margin-top: 0.25rem; }
  .mt-2 { margin-top: 0.5rem; }
  .mb-1 { margin-bottom: 0.25rem; }
  .mb-2 { margin-bottom: 0.5rem; }
  .mb-3 { margin-bottom: 0.75rem; }
  .mb-4 { margin-bottom: 1rem; }
  .mb-6 { margin-bottom: 1.5rem; }
  .mr-2 { margin-right: 0.5rem; }
  .mr-3 { margin-right: 0.75rem; }
  .ml-2 { margin-left: 0.5rem; }
  .p-3 { padding: 0.75rem; }
  .p-4 { padding: 1rem; }
  .p-6 { padding: 1.5rem; }
  .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
  .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
  .pb-2 { padding-bottom: 0.5rem; }
  .text-xs { font-size: 0.75rem; line-height: 1rem; }
  .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
  .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
  .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
  .text-2xl { font-size: 1.5rem; line-height: 2rem; }
  .font-medium { font-weight: 500; }
  .font-semibold { font-weight: 600; }
  .font-bold { font-weight: 700; }
  .w-full { width: 100%; }
  .justify-between { justify-content: space-between; }
  .items-center { align-items: center; }
  .justify-center { justify-content: center; }
  .bg-gradient-to-r { background: linear-gradient(to right, var(--tw-gradient-stops)); }
  .from-blue-600 { --tw-gradient-from: #2563eb; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(37, 99, 235, 0)); }
  .to-purple-600 { --tw-gradient-to: #9333ea; }
  .from-green-600 { --tw-gradient-from: #16a34a; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(22, 163, 74, 0)); }
  .to-emerald-600 { --tw-gradient-to: #059669; }
  
  /* Custom circular progress styles */
  .circular-progress {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  
  .circular-progress svg {
    transform: rotate(-90deg);
  }
  
  .circular-progress .progress-text {
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    font-weight: bold;
    color: white;
  }
  
  .metric-box {
    text-align: center;
    padding: 1rem;
  }
  
  .family-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }
  
  .family-member-card {
    transition: all 0.3s ease;
    border: 1px solid var(--bs-border-color);
  }
  
  .family-member-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  }
  
  .statistic-box {
    text-align: center;
    padding: 1rem;
  }
  
  .progress-bar-animated {
    transition: width 0.5s ease-in-out;
  }
  
  .react-dashboard {
    background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #1e293b 100%);
    min-height: 100vh;
    color: white;
  }
  
  .glass-card {
    background: rgba(30, 41, 59, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(148, 163, 184, 0.2);
    border-radius: 16px;
  }
  
  .gradient-primary {
    background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
  }
  
  .gradient-success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  }
</style>
{% endblock %}

{% block content %}
<div id="react-dashboard-root" class="react-dashboard p-4"></div>

<script type="text/babel">
const { useState, useEffect } = React;
const { createRoot } = ReactDOM;

// Utility functions
const healthUtils = {
  getStepsLevel: (steps) => {
    if (steps < 5000) return 'low';
    if (steps < 8000) return 'moderate';
    if (steps < 10000) return 'good';
    return 'excellent';
  },
  
  getStatusColor: (status) => {
    switch(status) {
      case 'excellent': return 'bg-success';
      case 'good': return 'bg-primary';
      case 'active': return 'bg-info';
      case 'warning': return 'bg-warning';
      default: return 'bg-secondary';
    }
  }
};

const formatNumber = (num) => {
  return new Intl.NumberFormat('ja-JP').format(num);
};

// Circular Progress Component
const CircularProgress = ({ percentage, size = 120, strokeWidth = 8, color = '#3b82f6' }) => {
  const radius = (size - strokeWidth) / 2;
  const circumference = radius * 2 * Math.PI;
  const strokeDasharray = circumference;
  const strokeDashoffset = circumference - (percentage / 100) * circumference;

  return React.createElement('div', 
    { className: 'circular-progress', style: { width: size, height: size } },
    React.createElement('svg', 
      { width: size, height: size },
      React.createElement('circle', {
        cx: size / 2,
        cy: size / 2,
        r: radius,
        stroke: '#374151',
        strokeWidth: strokeWidth,
        fill: 'none'
      }),
      React.createElement('circle', {
        cx: size / 2,
        cy: size / 2,
        r: radius,
        stroke: color,
        strokeWidth: strokeWidth,
        fill: 'none',
        strokeDasharray: strokeDasharray,
        strokeDashoffset: strokeDashoffset,
        strokeLinecap: 'round',
        style: { transition: 'stroke-dashoffset 0.5s ease-in-out' }
      })
    ),
    React.createElement('div', 
      { className: 'progress-text' },
      `${Math.round(percentage)}%`
    )
  );
};

// Health Dashboard Component
const FamilyHealthDashboard = () => {
  const [selectedMember, setSelectedMember] = useState('me');
  const [familyMembers, setFamilyMembers] = useState([]);
  const [todayStats, setTodayStats] = useState(null);
  const [familyStats, setFamilyStats] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  // Mock data for demonstration
  const defaultFamilyMembers = [
    { id: 'me', username: 'ã‚‚ãˆ', avatar: 'ğŸ‘§', status: 'excellent', todayScore: 92, isCurrentUser: true },
    { id: 'mom', username: 'ã™ãšã“', avatar: 'ğŸ‘©', status: 'good', todayScore: 87 },
    { id: 'dad', username: 'ãªãŠã²ã•', avatar: 'ğŸ‘¨', status: 'active', todayScore: 75 }
  ];

  const defaultTodayStats = {
    steps: { current: 8542, target: 10000, percentage: 85 },
    calories: { current: 320, target: 400, percentage: 80 },
    heartRate: { current: 72, status: 'normal' },
    activeMinutes: { current: 45, target: 60, percentage: 75 }
  };

  const defaultFamilyStats = {
    total_steps: 26392,
    total_calories: 6600,
    avg_steps: 8797,
    member_count: 3,
    active_members: 3
  };

  useEffect(() => {
    // Simulate API call delay
    setTimeout(() => {
      setFamilyMembers(defaultFamilyMembers);
      setTodayStats(defaultTodayStats);
      setFamilyStats(defaultFamilyStats);
      setLoading(false);
    }, 1000);
  }, []);

  if (loading) {
    return React.createElement('div', 
      { className: 'text-center py-5' },
      React.createElement('div', { className: 'spinner-border text-primary', role: 'status' }),
      React.createElement('p', { className: 'mt-3 text-light' }, 'å¥åº·ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...')
    );
  }

  if (error) {
    return React.createElement('div', 
      { className: 'alert alert-danger text-center' },
      error
    );
  }

  return React.createElement('div', 
    { className: 'container-fluid' },
    
    // Header
    React.createElement('div', 
      { className: 'row mb-4' },
      React.createElement('div', 
        { className: 'col-12' },
        React.createElement('div', 
          { className: 'd-flex justify-content-between align-items-center' },
          React.createElement('div', null,
            React.createElement('h1', { className: 'h2 text-light mb-1' }, 'ãŠã‹ãˆã‚Šãªã•ã„ï¼'),
            React.createElement('p', { className: 'text-light-emphasis' }, 'ä»Šæ—¥ã‚‚ä¸€ç·’ã«å¥åº·ã«ãªã‚Šã¾ã—ã‚‡ã†')
          ),
          React.createElement('div', 
            { className: 'd-flex align-items-center' },
            React.createElement('div', 
              { className: 'position-relative me-3' },
              React.createElement('div', 
                { 
                  className: 'position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success',
                  style: { width: '12px', height: '12px' }
                }
              ),
              React.createElement('i', { className: 'bi bi-gear fs-5 text-light' })
            )
          )
        )
      )
    ),

    // Family Members Selection
    familyMembers.length > 0 && React.createElement('div', 
      { className: 'row mb-4' },
      React.createElement('div', 
        { className: 'col-12' },
        React.createElement('h5', 
          { className: 'text-light mb-3 d-flex align-items-center' },
          React.createElement('i', { className: 'bi bi-people me-2' }),
          'å®¶æ—ã®ä»Šæ—¥ã®çŠ¶æ³'
        ),
        React.createElement('div', 
          { className: 'd-flex gap-3 overflow-auto pb-2' },
          familyMembers.map(member => 
            React.createElement('div', 
              {
                key: member.id,
                className: `glass-card p-3 text-center cursor-pointer ${selectedMember === member.id ? 'border-primary' : ''}`,
                style: { 
                  minWidth: '120px',
                  cursor: 'pointer',
                  transition: 'all 0.3s ease'
                },
                onClick: () => setSelectedMember(member.id)
              },
              React.createElement('div', { className: 'fs-1 mb-2' }, member.avatar),
              React.createElement('div', { className: 'fw-semibold text-light' }, member.username),
              React.createElement('div', 
                { 
                  className: `badge ${healthUtils.getStatusColor(member.status)} mt-2`
                },
                `${member.todayScore}ç‚¹`
              ),
              member.isCurrentUser && React.createElement('div', 
                { className: 'badge bg-primary mt-1' },
                'ã‚ãªãŸ'
              )
            )
          )
        )
      )
    ),

    // Main Stats
    React.createElement('div', 
      { className: 'row mb-4' },
      React.createElement('div', 
        { className: 'col-12' },
        React.createElement('div', 
          { className: 'glass-card gradient-primary p-4 mb-4' },
          React.createElement('div', 
            { className: 'd-flex justify-content-between align-items-center' },
            React.createElement('div', null,
              React.createElement('h3', { className: 'text-light mb-2' }, 'ä»Šæ—¥ã®é€²æ—'),
              React.createElement('p', { className: 'text-light-emphasis mb-0' }, 'ç›®æ¨™ã¾ã§ã‚ã¨å°‘ã—ï¼')
            ),
            CircularProgress({ 
              percentage: todayStats.steps.percentage, 
              size: 100, 
              color: '#ffffff' 
            })
          )
        )
      )
    ),

    // Detailed Stats Grid
    React.createElement('div', 
      { className: 'row g-3 mb-4' },
      
      // Steps
      React.createElement('div', 
        { className: 'col-md-6 col-lg-3' },
        React.createElement('div', 
          { className: 'glass-card p-4 h-100' },
          React.createElement('div', 
            { className: 'd-flex justify-content-between align-items-center mb-3' },
            React.createElement('i', { className: 'bi bi-lightning text-success fs-4' }),
            React.createElement('span', { className: 'text-light-emphasis small' }, 'æ­©æ•°')
          ),
          React.createElement('div', { className: 'fs-3 fw-bold text-light mb-1' }, formatNumber(todayStats.steps.current)),
          React.createElement('div', { className: 'text-light-emphasis small mb-2' }, `ç›®æ¨™: ${formatNumber(todayStats.steps.target)}`),
          React.createElement('div', 
            { className: 'progress' },
            React.createElement('div', 
              { 
                className: 'progress-bar bg-success progress-bar-animated',
                style: { width: `${Math.min(todayStats.steps.percentage, 100)}%` }
              }
            )
          )
        )
      ),

      // Calories
      React.createElement('div', 
        { className: 'col-md-6 col-lg-3' },
        React.createElement('div', 
          { className: 'glass-card p-4 h-100' },
          React.createElement('div', 
            { className: 'd-flex justify-content-between align-items-center mb-3' },
            React.createElement('i', { className: 'bi bi-fire text-danger fs-4' }),
            React.createElement('span', { className: 'text-light-emphasis small' }, 'ã‚«ãƒ­ãƒªãƒ¼')
          ),
          React.createElement('div', { className: 'fs-3 fw-bold text-light mb-1' }, formatNumber(todayStats.calories.current)),
          React.createElement('div', { className: 'text-light-emphasis small mb-2' }, `ç›®æ¨™: ${formatNumber(todayStats.calories.target)}`),
          React.createElement('div', 
            { className: 'progress' },
            React.createElement('div', 
              { 
                className: 'progress-bar bg-danger progress-bar-animated',
                style: { width: `${Math.min(todayStats.calories.percentage, 100)}%` }
              }
            )
          )
        )
      ),

      // Heart Rate
      React.createElement('div', 
        { className: 'col-md-6 col-lg-3' },
        React.createElement('div', 
          { className: 'glass-card p-4 h-100' },
          React.createElement('div', 
            { className: 'd-flex justify-content-between align-items-center mb-3' },
            React.createElement('i', { className: 'bi bi-heart text-info fs-4' }),
            React.createElement('span', { className: 'text-light-emphasis small' }, 'å¿ƒæ‹æ•°')
          ),
          React.createElement('div', { className: 'fs-3 fw-bold text-light mb-1' }, todayStats.heartRate.current),
          React.createElement('div', 
            { className: `small ${todayStats.heartRate.status === 'normal' ? 'text-success' : 'text-warning'}` },
            todayStats.heartRate.status === 'normal' ? 'æ­£å¸¸ç¯„å›²' : 'è¦æ³¨æ„'
          )
        )
      ),

      // Active Minutes
      React.createElement('div', 
        { className: 'col-md-6 col-lg-3' },
        React.createElement('div', 
          { className: 'glass-card p-4 h-100' },
          React.createElement('div', 
            { className: 'd-flex justify-content-between align-items-center mb-3' },
            React.createElement('i', { className: 'bi bi-activity text-warning fs-4' }),
            React.createElement('span', { className: 'text-light-emphasis small' }, 'æ´»å‹•æ™‚é–“')
          ),
          React.createElement('div', { className: 'fs-3 fw-bold text-light mb-1' }, `${todayStats.activeMinutes.current}åˆ†`),
          React.createElement('div', { className: 'text-light-emphasis small mb-2' }, `ç›®æ¨™: ${todayStats.activeMinutes.target}åˆ†`),
          React.createElement('div', 
            { className: 'progress' },
            React.createElement('div', 
              { 
                className: 'progress-bar bg-warning progress-bar-animated',
                style: { width: `${Math.min(todayStats.activeMinutes.percentage, 100)}%` }
              }
            )
          )
        )
      )
    ),

    // Motivation Message
    React.createElement('div', 
      { className: 'row mb-4' },
      React.createElement('div', 
        { className: 'col-12' },
        React.createElement('div', 
          { className: 'glass-card gradient-success p-4' },
          React.createElement('div', 
            { className: 'd-flex align-items-center' },
            React.createElement('i', { className: 'bi bi-star text-warning fs-4 me-3' }),
            React.createElement('div', null,
              React.createElement('div', { className: 'fw-semibold text-light' }, 'ä»Šæ—¥ã®åŠ±ã¾ã—'),
              React.createElement('div', { className: 'text-light-emphasis' }, 
                `ã‚ã¨${formatNumber(todayStats.steps.target - todayStats.steps.current)}æ­©ã§ç›®æ¨™é”æˆï¼å®¶æ—ã¿ã‚“ãªã§${formatNumber(familyStats.total_steps)}æ­©é”æˆä¸­ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦`
              )
            )
          )
        )
      )
    ),

    // Family Stats
    familyStats && React.createElement('div', 
      { className: 'row mb-4' },
      React.createElement('div', 
        { className: 'col-12' },
        React.createElement('div', 
          { className: 'glass-card p-4' },
          React.createElement('h5', 
            { className: 'text-light mb-3 d-flex align-items-center' },
            React.createElement('i', { className: 'bi bi-bar-chart text-primary me-2' }),
            'ã‚°ãƒ«ãƒ¼ãƒ—çµ±è¨ˆï¼ˆä»Šæ—¥ï¼‰'
          ),
          React.createElement('div', 
            { className: 'row text-center g-4' },
            React.createElement('div', 
              { className: 'col-md-3 col-6' },
              React.createElement('div', { className: 'fs-2 fw-bold text-primary' }, formatNumber(familyStats.total_steps)),
              React.createElement('div', { className: 'text-light-emphasis' }, 'åˆè¨ˆæ­©æ•°')
            ),
            React.createElement('div', 
              { className: 'col-md-3 col-6' },
              React.createElement('div', { className: 'fs-2 fw-bold text-danger' }, formatNumber(familyStats.total_calories)),
              React.createElement('div', { className: 'text-light-emphasis' }, 'åˆè¨ˆã‚«ãƒ­ãƒªãƒ¼')
            ),
            React.createElement('div', 
              { className: 'col-md-3 col-6' },
              React.createElement('div', { className: 'fs-2 fw-bold text-success' }, familyStats.active_members),
              React.createElement('div', { className: 'text-light-emphasis' }, 'æ´»å‹•ãƒ¡ãƒ³ãƒãƒ¼')
            ),
            React.createElement('div', 
              { className: 'col-md-3 col-6' },
              React.createElement('div', { className: 'fs-2 fw-bold text-info' }, formatNumber(familyStats.avg_steps)),
              React.createElement('div', { className: 'text-light-emphasis' }, 'å¹³å‡æ­©æ•°')
            )
          )
        )
      )
    ),

    // Quick Actions
    React.createElement('div', 
      { className: 'row' },
      React.createElement('div', 
        { className: 'col-md-6 mb-3' },
        React.createElement('button', 
          { className: 'btn btn-primary btn-lg w-100 d-flex align-items-center justify-content-center' },
          React.createElement('i', { className: 'bi bi-graph-up me-2' }),
          'è©³ç´°åˆ†æ'
        )
      ),
      React.createElement('div', 
        { className: 'col-md-6 mb-3' },
        React.createElement('button', 
          { className: 'btn btn-secondary btn-lg w-100 d-flex align-items-center justify-content-center' },
          React.createElement('i', { className: 'bi bi-calendar me-2' }),
          'ãƒãƒ£ãƒ¬ãƒ³ã‚¸'
        )
      )
    )
  );
};

// Mount the React component
const root = createRoot(document.getElementById('react-dashboard-root'));
root.render(React.createElement(FamilyHealthDashboard));
</script>
{% endblock %}